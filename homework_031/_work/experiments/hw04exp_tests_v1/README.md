# Домашнее задание №4. Testing Scoring API
Курс "Python Developer. Professional"

## Сервис
Сервис представляет собой HTTP-сервер, реализующий API скоринга.
Сервис принимает HTTP POST-запросы с параметрами в формате JSON
и возвращает либо результаты выполнения запроса, либо сообщение об ошибке.

Сервис использует Redis для долговременного хранения и кеширования данных. 
Сервер Redis запускается отдельно; в случае недоступности хранилища сервер 
может работать, но отвечает на все запросы, требующие доступа к 
персистентному хранилищу, `500 Internal Server Error`.

Запуск сервера: `$ python api.py [--port HTTP_PORT] [--log PATH/TO/LOG/FILE] [--storage-host HTTP_HOST] [--storage-port HTTP_PORT]`

Завершение сервера: по сигналу с клавиатуры

Предполагаемая версия интерпретатора: `3.9`

Параметры командной строки:
- `--port`: HTTP-порт, который слушает сервер, по умолчанию 8080
- `--log`: путь до файла логов сервера, по умолчанию логи пишутся в `stderr`
- `--storage-host`, `--storage-port`: адрес сервера Redis, использующегося для хранилища, по умолчанию `localhost:6379`

Варианты ответа сервера:
- при успешном выполнении запроса возвращает `200 OK` и JSON с результатами выполнения запроса
- при ошибке парсинга запроса как JSON возвращает `400 Bad Request`
- при ошибке валидации запроса возвращает `422 Invalid Request` и описание ошибки валидации в формате plain text
- при ошибке авторизации возвращает `403 Forbidden`
- при попытке вызова несуществующего метода (отличного от `online_score` или `clients_interests`) возвращает `404 Not Found`
- при запуске без персистентного хранилища метод `clients_interests` всегда возвращает `500 Internal Server Error`

## Тесты
Для тестирования используется фреймворк `pytest`.

Тесты лежат в папке `tests`. Доступны следующие тесты:
- `tests/unit` - модульные тесты
  - `tests/unit/test_basic.py`: юнит-тесты базовой функциональности: создание классов запросов и полей, наследование запросов, валидация `required` и `nullable`, специфическая валидация запросов
  - `tests/unit/test_fields.py`: юнит-тесты всех классов полей, проверка корректности иерархии валидации
  - `tests/unit/test_requests.py`: юнит-тесты тех классов запросов, которые сложнее списка полей (в настоящий момент - только `OnlineScoreRequest`)
  - `tests/unit/test_functional.py`: функциональные тесты метода `method_handler`
- `tests/integration` - интеграционные тесты долговременного хранилища; обратите внимание, что его также нужно запускать отдельно (запуск настроен в GitLab CI/CD)
  - `tests/integration/test_redis_client.py` - тесты клиента Redis при нормальном подключении к серверу
  - `tests/integration/test_redis_client_noaccess.py` - тесты клиента Redis в случае, когда подключение не установлено
  - `tests/unit/test_functional.py`: функциональные тесты метода `method_handler` с настоящим долговременным хранилищем

Запуск:
- чтобы запустить всё, можно выполнить `$ pytest tests`
- каждый из файлов можно запустить на тестирование отдельно, например, `$ pytest tests/unit/test_basics.py`
- с помощью пакета `coverage` можно получить покрытие кода: `$ coverage run -m pytest tests && coverage report -m`
